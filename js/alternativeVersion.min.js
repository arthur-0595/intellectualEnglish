$(function(){var userMessage=sessionStorage.userMessage;if(userMessage){userMessage=JSON.parse(userMessage);var username=userMessage[0].ID;}else{alert('检测到您未登录，请先登录！');window.location='../index.html';}
var textbook_id,version_id,chapter_id;var textbook_name,version_name,chapter_name;var type,typeStr,typeEnglish;type=sessionStorage.type;typeStr=sessionStorage.typeStr;typeEnglish=sessionStorage.typeEnglish;version_id=sessionStorage.version_id;textbook_id=sessionStorage.textbook_id;chapter_id=sessionStorage.chapter_id;version_name=sessionStorage.version_name;textbook_name=sessionStorage.textbook_name;chapter_name=sessionStorage.chapter_name;if(version_name&&textbook_name&&chapter_name){var courseP=version_name+' - '+textbook_name;$("#course p").html(courseP);$("#sectionBox p").html(chapter_name);}
(function(){var typeEnglish=['Intelligent Memory'];$("#centerSpan").html(typeStr);var cenBook=`<div class="pic">
      <img src="../imgs/home/${type}.png" />
     </div>
     <h3>${typeStr}</h3>
     <span>${typeEnglish}</span>
     <i>点击开始学习</i>`;$("#cen_book").html(cenBook);$("#category_h").html(`${type}
       <span>${typeEnglish}</span>`);$("#title_h").html(typeStr);})();$("#clickBook").on("click",function(){if(textbook_id&&version_id&&chapter_id){if(type==01){window.location='word_memory.html';}else if(type==02){window.location='word_listen.html';}else if(type==03){window.location='word_write.html';}else if(type==04){window.location='sentence_listen.html';}else if(type==05){window.location='sentence_interpret.html';}else if(type==06){window.location='sentence_write.html';}else{alert("相关页面开发未完成");}}else{alert("请确认已选择好课程及相关章节");}});$("#courseNavs>li").on("click",function(){var thisindex=$(this).index();$("#courseNavs>li").removeClass("checked");$(this).addClass("checked");$("#mainBot>li").hide();$("#mainBot>li").eq(thisindex).show();if(thisindex==0){$.ajax({type:"POST",url:thisUrl2+'/Areas/Api/index.ashx',dataType:"json",data:{method:"GetStudy",user_id:username},success:function(data){if(data.length>=1){var nhtml='';$.each(data,function(index,element){nhtml+=`<tr data-textbookid = "${element.textbook_id}" data-versionId = "${element.version_id}" data-versionname = "${element.version_name}" data-textbookname = "${element.textbook_name}">
        <td class="StudycourseName">${element.version_name} - ${element.textbook_name}</td>
        <td>两个小时前</td>
        <td>
         <a href="javascript:;">查看</a>
         <div class="studyRateBox"></div>
        </td>
        <td class="startStudy">学习</td>
       </tr>`;})
$("#myCourses tbody").html(nhtml);$(".startStudy").on("click",function(){fnselectingTextbooksTog();textbook_id=$(this).parent("tr")[0].dataset.textbookid;version_id=$(this).parent("tr")[0].dataset.versionid;textbook_name=$(this).parent("tr")[0].dataset.textbookname;version_name=$(this).parent("tr")[0].dataset.versionname;sessionStorage.textbook_id=textbook_id;sessionStorage.version_id=version_id;sessionStorage.textbook_name=textbook_name;sessionStorage.version_name=version_name;var name=$(this).parent("tr").find("td.StudycourseName").html();$("#course p").html(name);});}}});}else{$.ajax({type:"POST",url:thisUrl+'/Areas/Api/Interface.ashx',dataType:"json",data:{method:"GetSeries",user_id:username},success:function(data){if(data.length>=1){var nhtml='';$.each(data,function(index,element){nhtml+=`<li class="padL30" data-seseriesId = "${element.series_id}" >${element.series_name}</li>`;});$("#mainleft").html(nhtml);$("#mainleft>li").on("click",function(){var thisseseriesid=this.dataset.seseriesid;$.ajax({type:"POST",url:thisUrl+'/Areas/Api/Interface.ashx',dataType:"json",data:{method:"GetVersionBySeriesID",user_id:username,series_id:thisseseriesid},success:function(data){if(data.length>=1){var nhtml='';$.each(data,function(index,element){nhtml+=`<li class="padL30" data-seseriesId = "${element.series_id}" data-versionId = "${element.version_id}"  data-versionname = "${element.version_name}" >${element.version_name}</li>`;});$("#mainmid").show();$("#mainmid").html(nhtml);$("#mainmid>li").on("click",function(){var thisversionid=this.dataset.versionid;version_name=this.dataset.versionname;sessionStorage.version_name=version_name;$("#course p").html(this.innerHTML);$("#course p").append(' - ');$.ajax({type:"POST",url:thisUrl+'/Areas/Api/Interface.ashx',dataType:"json",data:{method:"GetTextBookByVersionID",user_id:username,version_id:thisversionid},success:function(data){if(data.length>=1){var nhtml='';$.each(data,function(index,element){nhtml+=`<li class="padL30" data-textbookid = "${element.textbook_id}" data-versionId = "${element.version_id}" data-textbookname = "${element.textbook_name}" >${element.textbook_name}</li>`;});$("#mainright").show();$("#mainright").html(nhtml);$("#mainright>li").on("click",function(){var thistextbookid=this.dataset.textbookid;textbook_id=this.dataset.textbookid;version_id=this.dataset.versionid;textbook_name=this.dataset.textbookname;sessionStorage.textbook_id=textbook_id;sessionStorage.version_id=version_id;sessionStorage.textbook_name=textbook_name;fnselectingTextbooksTog();$("#course p").append(this.innerHTML);})}}});})}}});})}}});}})
$("#course").on("click",function(){fnselectingTextbooksTog();})
$("#sectionBox").on("click",function(){fnchapterList();})
$("#test").on("click",function(){$("#testList").toggle();if($("#testList").css("display")=="block"){$("#test").css("border-radius","18px 18px 0 0 ");$("#test").find("i").css("transform","rotate(180deg)");}else{$("#test").css("border-radius","18px");$("#test").find("i").css("transform","rotate(0deg)");}})
function fnselectingTextbooksTog(){$("#selectingTextbooks").toggle();if($("#selectingTextbooks").css("display")=="block"){$("#course").css("border-radius","18px 18px 0 0 ");$("#course").find("i").css("transform","rotate(180deg)");$("#courseNavs li").eq(0).trigger("click");}else{$("#course").css("border-radius","18px");$("#course").find("i").css("transform","rotate(0deg)");}}
function fnchapterList(){$("#chapterList").toggle();if($("#chapterList").css("display")=="block"){$("#sectionBox").css("border-radius","18px 18px 0 0 ");$("#sectionBox").find("i").css("transform","rotate(180deg)");fnshowUnit();}else{$("#sectionBox").css("border-radius","18px");$("#sectionBox").find("i").css("transform","rotate(0deg)");}}
function fnshowUnit(){$.ajax({type:"POST",url:thisUrl2+'/Areas/Api/index.ashx',dataType:"json",data:{method:"GetUnitByTextBookID",textbook_id:textbook_id},success:function(data){if(data.length>=1){var nhtml='';$.each(data,function(index,element){nhtml+=`<li id="${element.id}" data-chaptername="${element.unit_name}">${element.unit_name}</li>`;})
$("#chapterList").html(nhtml);$("#chapterList>li").on("click",function(){var thisname=$(this).html();$("#sectionBox p").html(thisname);chapter_id=this.id;chapter_name=this.dataset.chaptername;sessionStorage.chapter_id=chapter_id;sessionStorage.chapter_name=chapter_name;fnchapterList();$("#chapterList").hide();});}}});}})